https://script.google.com/macros/s/AKfycby0HZfgBx_KdC1zSQ_dJizRUyTwBJdbcFRVWZ1Gf59Aq_wqDcEwxZvtiWFe4ke_8yZ7Qg/exec






// Serve HTML frontend
function doGet(e) {
  return HtmlService.createHtmlOutputFromFile('index.html')
    .setTitle('Enhanced Chat Application');
}

// Save a new message
function saveMessage(user, message) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('ChatMessages');
  message = convertToEmoji(message); // Convert text to emoji
  sheet.appendRow([new Date(), user, message, false]);
}

// Fetch all messages
function getMessages() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('ChatMessages');
  const data = sheet.getDataRange().getValues();
  const messages = data.slice(1).map(row => ({
    timestamp: row[0],
    user: row[1],
    message: row[2],
    typing: row[3],
  }));
  return messages;
}

// Update typing status
function updateTypingStatus(user, isTyping) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('ChatMessages');
  const data = sheet.getDataRange().getValues();
  data.forEach((row, index) => {
    if (row[1] === user && index > 0) {
      sheet.getRange(index + 1, 4).setValue(isTyping);
    }
  });
}

// Validate user credentials
function validateUser(username, password) {
  const users = {
    user1: 'password1',
    user2: 'password2',
  };
  return users[username] === password;
}

// Convert text to emojis
function convertToEmoji(text) {
  return text
    .replace(':)', 'üòä')
    .replace(':(', '‚òπÔ∏è')
    .replace(':D', 'üòÑ')
    .replace(';)', 'üòâ');
}











<!DOCTYPE html>
<html>
<head>
  <title>Enhanced Chat App</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #chat-box {
      border: 1px solid #ccc;
      padding: 10px;
      height: 400px;
      overflow-y: auto;
    }
    .message {
      margin-bottom: 10px;
    }
    .timestamp {
      font-size: 0.8em;
      color: gray;
    }
    .typing {
      font-style: italic;
      color: blue;
    }
    img {
      max-width: 200px;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1>Chat Application</h1>
    <div id="chat-box" class="border rounded p-3 mb-3"></div>
    <p id="typing-indicator" class="typing"></p>
    <input type="text" id="search-bar" class="form-control mb-3" placeholder="Search messages" />
    <form id="chat-form" class="d-flex">
      <input type="text" id="username" class="form-control me-2" placeholder="Your name" required />
      <input type="text" id="message" class="form-control me-2" placeholder="Your message" required />
      <button type="submit" class="btn btn-primary">Send</button>
    </form>
    <input type="file" id="file-input" class="form-control mt-3" />
  </div>

  <script>
    const chatBox = document.getElementById('chat-box');
    const typingIndicator = document.getElementById('typing-indicator');
    let messages = [];

    // Fetch messages from the server
    function fetchMessages() {
      google.script.run.withSuccessHandler(displayMessages).getMessages();
    }

    // Display messages
    function displayMessages(fetchedMessages) {
      messages = fetchedMessages;
      chatBox.innerHTML = '';
      messages.forEach(msg => {
        const div = document.createElement('div');
        div.className = 'message';
        div.innerHTML = `
          <strong>${msg.user}</strong>: ${msg.message} 
          <span class="timestamp">[${new Date(msg.timestamp).toLocaleString()}]</span>`;
        chatBox.appendChild(div);
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Show typing indicator
    function showTypingIndicator(user) {
      typingIndicator.textContent = `${user} is typing...`;
    }

    // Clear typing indicator
    function clearTypingIndicator() {
      typingIndicator.textContent = '';
    }

    // Notify user of new messages
    function notifyUser(title, message) {
      if (Notification.permission === 'granted') {
        new Notification(title, { body: message });
      } else if (Notification.permission !== 'denied') {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            new Notification(title, { body: message });
          }
        });
      }
    }

    // Handle message sending
    document.getElementById('chat-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const user = document.getElementById('username').value;
      const message = document.getElementById('message').value;
      google.script.run.saveMessage(user, message);
      document.getElementById('message').value = '';
      fetchMessages();
    });

    // Handle typing status
    document.getElementById('message').addEventListener('input', function() {
      const user = document.getElementById('username').value;
      if (user) {
        google.script.run.updateTypingStatus(user, true);
        setTimeout(() => {
          google.script.run.updateTypingStatus(user, false);
        }, 2000);
      }
    });

    // Handle file uploads
    document.getElementById('file-input').addEventListener('change', function() {
      const file = this.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const user = document.getElementById('username').value;
        const message = `<img src="${e.target.result}" alt="Shared Image" />`;
        google.script.run.saveMessage(user, message);
        fetchMessages();
      };
      reader.readAsDataURL(file);
    });

    // Search functionality
    document.getElementById('search-bar').addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      const filteredMessages = messages.filter(msg =>
        msg.message.toLowerCase().includes(searchTerm)
      );
      chatBox.innerHTML = '';
      filteredMessages.forEach(msg => {
        const div = document.createElement('div');
        div.className = 'message';
        div.innerHTML = `
          <strong>${msg.user}</strong>: ${msg.message} 
          <span class="timestamp">[${new Date(msg.timestamp).toLocaleString()}]</span>`;
        chatBox.appendChild(div);
      });
    });

    // Fetch messages periodically
    setInterval(fetchMessages, 2000);
  </script>
</body>
</html>
